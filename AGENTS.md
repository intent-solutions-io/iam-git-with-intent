# Git With Intent - Agent Documentation

> **For AI Assistants**: Copy this link and tell your AI: "Read this file for context"
> â†’ https://raw.githubusercontent.com/intent-solutions-io/iam-git-with-intent/main/AGENTS.md

## Overview

Git With Intent (GWI) is an AI-powered CLI for PR automation featuring semantic merge conflict resolution, issue-to-code generation, complexity scoring, and full autopilot with approval gating.

## Available Agents

| Agent | Purpose | Default Model | Complexity Range |
|-------|---------|---------------|------------------|
| **Slop Detector** | Detect AI-generated low-quality PRs | Gemini Flash | 1-3 |
| **Triage** | Score PR complexity (1-10) | Gemini Flash / Haiku | 1-5 |
| **Coder** | Generate code from issues | Sonnet â†’ Opus | 4-10 |
| **Resolver** | Resolve merge conflicts | Sonnet â†’ Opus | 5-10 |
| **Reviewer** | Generate PR review summaries | Sonnet | 3-7 |
| **Orchestrator** | Coordinate multi-agent workflows | Gemini Flash | 1-3 |

## Slop Detector Agent

The Slop Detector identifies AI-generated low-quality contributions that waste maintainer time with superficial changes.

### SPIFFE Identity

```
spiffe://intent.solutions/agent/slop-detector
```

### Score Ranges

| Score | Status | Action |
|-------|--------|--------|
| **0-30** | âœ… Allow | Low risk - proceed normally |
| **31-60** | âš ï¸ Flag | Review recommended |
| **61-75** | ðŸ”¶ Warn | High risk - flag with warning comment |
| **76-100** | âŒ Auto-close | Likely AI slop - auto-close with explanation |

### Detection Signals

#### Linguistic Signals (AI Text Patterns)

| Signal | Weight | Description |
|--------|--------|-------------|
| `templated_improvements` | 15 | "I've made some improvements to enhance..." |
| `over_politeness` | 10 | "I hope this helps! Let me know if..." |
| `generic_value_claims` | 10 | "enhances the user experience" |
| `obvious_docstrings` | 20 | Adding JSDoc to obvious one-liners |
| `perfect_markdown` | 5 | Suspiciously perfect markdown formatting |
| `ai_disclosure` | 25 | "generated by ChatGPT/Claude/GPT" |
| `hallucinated_refs` | 30 | References to non-existent issues/users |
| `filler_phrases` | 8 | "It's worth noting that..." |
| `comment_heavy_pr` | 20 | >70% of additions are comments |

#### Contributor Signals (Reputation)

| Signal | Weight | Description |
|--------|--------|-------------|
| `first_time_contributor` | 15 | No prior PRs to this repo |
| `no_engagement` | 20 | No issues, comments, or discussions |
| `burst_submissions` | 25 | >5 PRs in 24 hours |
| `new_account` | 15 | Account <30 days old with <3 repos |
| `cross_repo_spam` | 30 | Similar PRs across multiple repos |

#### Quality Signals (Change Value)

| Signal | Weight | Description |
|--------|--------|-------------|
| `cosmetic_only` | 20 | Whitespace/formatting only |
| `comment_spam` | 25 | Adds obvious comments |
| `readme_inflation` | 15 | Only README changes, no code |
| `no_functional_change` | 20 | Type annotations only |
| `testless_feature` | 10 | New code without tests |
| `tiny_change` | 8 | <5 additions and <5 deletions |
| `markdown_only` | 12 | All files are markdown |

### Usage

#### CLI

```bash
# Check a single PR
gwi slop check https://github.com/owner/repo/pull/123

# Report on repo's slop metrics
gwi slop report owner/repo

# Configure thresholds
gwi slop config --allow-max 25 --warn-max 70
```

#### Programmatic

```typescript
import { createSlopDetectorAgent } from '@gwi/agents';

const detector = createSlopDetectorAgent({
  allowMax: 30,
  flagMax: 60,
  warnMax: 75,
});

await detector.initialize();

const result = await detector.analyze({
  prUrl: 'https://github.com/owner/repo/pull/123',
  diff: '...diff content...',
  prTitle: 'Update README',
  prBody: 'PR description...',
  contributor: 'username',
  files: [{ path: 'README.md', additions: 5, deletions: 0 }],
});

console.log(result.slopScore);      // 0-100
console.log(result.recommendation); // 'allow' | 'flag' | 'auto_close'
console.log(result.signals);        // Array of detected signals
```

### A2A Protocol

Slop Detector exposes the `slop-detection` task type for inter-agent messaging:

```typescript
// Send task to Slop Detector via A2A
const task: TaskRequestPayload = {
  taskType: 'slop-detection',
  input: {
    prUrl: 'https://github.com/owner/repo/pull/123',
    diff: '...diff content...',
    prTitle: 'Update README',
    prBody: 'PR description...',
    contributor: 'username',
    files: [{ path: 'README.md', additions: 5, deletions: 0 }],
  },
};
```

## Model Selection

GWI automatically routes tasks to optimal models based on complexity:

| Complexity | Tier | Models |
|------------|------|--------|
| 1-3 (Low) | 1 | Gemini Flash, GPT-4o-mini, Haiku |
| 4-7 (Medium) | 3 | Claude Sonnet, GPT-4o |
| 8-10 (High) | 5 | Claude Opus, o1 |

### Configuring Providers

```bash
# Required: At least one provider
export ANTHROPIC_API_KEY="..."
export GOOGLE_AI_API_KEY="..."
export OPENAI_API_KEY="..."

# Optional: Additional providers
export GROQ_API_KEY="..."
export TOGETHER_API_KEY="..."
export DEEPSEEK_API_KEY="..."
```

## Integration with CI/CD

### GitHub Actions

```yaml
name: Slop Detection
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  slop-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup GWI
        run: npm install -g @gwi/cli

      - name: Check for Slop
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GOOGLE_AI_API_KEY: ${{ secrets.GOOGLE_AI_API_KEY }}
        run: |
          gwi slop check ${{ github.event.pull_request.html_url }}
```

### Webhook Integration

```typescript
// apps/github-webhook handles PR events
// Automatically triggers slop detection on:
// - pull_request.opened
// - pull_request.synchronize
```

## Security

### Input Validation

All inputs are validated with Zod schemas with bounded constraints:

- URL: max 2048 chars
- Diff: max 1MB
- Title: max 500 chars
- Body: max 100KB
- Files: max 1000 entries

### Audit Logging

All A2A operations are logged with:

- Timestamp (ISO 8601)
- SPIFFE ID
- Task ID (crypto.randomUUID)
- Operation type
- Duration

### Prompt Injection Protection

User content is sanitized before LLM processing:

- Role markers stripped
- XML-like tags removed
- Content truncated to safe limits

## Architecture

```
GitHub Webhook â†’ SignalStore â†’ TriageAgent
                                    â†“
                            SlopDetectorAgent
                                    â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                            â†“       â†“       â†“
                      Linguistic  Contributor  Quality
                       Analyzer    Analyzer    Analyzer
                            â†“       â†“       â†“
                            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                              Slop Score (0-100)
                                    â†“
                         Action: flag/close/allow
```

## CLI Commands

```bash
# PR Operations
gwi triage <pr-url>      # Score PR complexity
gwi resolve <pr-url>     # Resolve merge conflicts
gwi review <pr-url>      # Generate review summary
gwi review --local       # Review staged changes
gwi issue-to-code <url>  # Create PR from issue
gwi autopilot <pr-url>   # Full pipeline with approval

# Run Management
gwi run list             # List recent runs
gwi run status <id>      # Check run details
gwi run approve <id>     # Approve pending changes

# Slop Detection
gwi slop check <pr-url>  # Check single PR
gwi slop report <repo>   # Repo slop metrics
gwi slop config          # Configure thresholds

# Utilities
gwi gate                 # Pre-commit approval gate
gwi hooks install        # Install pre-commit hook
gwi explain <run-id>     # Explain AI decisions
gwi provider list        # List available providers
```

## Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `ANTHROPIC_API_KEY` | One of these | Anthropic (Claude) API key |
| `GOOGLE_AI_API_KEY` | One of these | Google AI (Gemini) API key |
| `OPENAI_API_KEY` | One of these | OpenAI API key |
| `GITHUB_TOKEN` | Yes | GitHub access token |
| `GWI_STORE_BACKEND` | No | Storage backend (firestore/sqlite/memory) |

## Links

- **Repository**: https://github.com/intent-solutions-io/iam-git-with-intent
- **Documentation**: See `000-docs/` directory
- **Model Selection**: See `000-docs/120-DR-RUBR-model-selection-rubric.md`
- **Threat Model**: See `000-docs/110-DR-TMOD-security-threat-model.md`

## Support

For issues and feature requests, please file an issue on GitHub.
